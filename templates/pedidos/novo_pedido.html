{% extends "base.html" %}

{% block title %}Novo Pedido - SystemLR{% endblock %}

{% block extra_js %}
<script>
let itemCount = 0;
function adicionarItem() {
    const container = document.getElementById('itensContainer');
    const row = document.createElement('div');
    row.className = 'item-row';
    row.innerHTML = `
        <select name="produto_${itemCount}" required class="form-control">
            <option value="">Selecione um produto</option>
            {% for p in produtos %}
            <option value="{{ p.id }}">{{ p.nome }}</option>
            {% endfor %}
        </select>
        <input type="number" name="quantidade_${itemCount}" value="1" min="1" required class="form-control" style="width:80px; margin-left:8px;">
        <button type="button" class="btn btn-secondary" onclick="this.parentElement.remove();">✖</button>
    `;
    container.appendChild(row);
    itemCount++;
    document.getElementById('item_count').value = itemCount;
}
</script>
{% endblock %}

{% block content %}
<h1>Novo Pedido</h1>
<form method="POST" id="formPedido" onsubmit="return validarFormulario('formPedido')">
    <div class="form-group">
        <label for="mesa_id">Mesa (opcional)</label>
        <select name="mesa_id" id="mesa_id" class="form-control">
            <option value="">Nenhuma</option>
            {% for m in mesas %}
            <option value="{{ m.id }}">{{ m.numero }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="caixa_id">Caixa</label>
        <select name="caixa_id" id="caixa_id" class="form-control" required>
            <option value="">Selecione</option>
            {% for c in caixas %}
            <option value="{{ c.id }}">{{ c.nome }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="observacoes">Observações</label>
        <textarea name="observacoes" id="observacoes" class="form-control"></textarea>
    </div>
    <h3>Itens</h3>
    <div id="itensContainer"></div>
    <input type="hidden" name="item_count" id="item_count" value="0">
    <button type="button" class="btn btn-secondary" onclick="adicionarItem()">➕ Adicionar Item</button>
    <br><br>
    <button type="submit" class="btn btn-primary">Salvar Pedido</button>
    <a href="{{ url_for('listar_pedidos') }}" class="btn btn-secondary">✕ Cancelar</a>
</form>
{% endblock %}